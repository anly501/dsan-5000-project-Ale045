<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tianze Yang">

<title>Project Website - An Analysis of the Trend in Today’s Music Industry</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Project Website</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About Me</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./code.html" rel="" target="">
 <span class="menu-text">Code</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data.html" rel="" target="">
 <span class="menu-text">Data</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./introduction.html" rel="" target="" aria-current="page">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data_garther.html" rel="" target="">
 <span class="menu-text">Data Garther</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data_cleaning.html" rel="" target="">
 <span class="menu-text">Data Cleaning</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./data_exploration.html" rel="" target="">
 <span class="menu-text">Data Exploration</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./clustering.html" rel="" target="">
 <span class="menu-text">Clustering</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dimensionality_reduction.html" rel="" target="">
 <span class="menu-text">Dimensionality Reduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./dicision_tree.html" rel="" target="">
 <span class="menu-text">Decision Tree</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./arm.html" rel="" target="">
 <span class="menu-text">ARM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./conclusion.html" rel="" target="">
 <span class="menu-text">Conclusion</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#project-introduction" id="toc-project-introduction" class="nav-link active" data-scroll-target="#project-introduction">Project Introduction</a></li>
  <li><a href="#background-research-works-done-in-this-field" id="toc-background-research-works-done-in-this-field" class="nav-link" data-scroll-target="#background-research-works-done-in-this-field">Background: Research Works Done in this Field</a></li>
  <li><a href="#research-goal-and-hypothesis" id="toc-research-goal-and-hypothesis" class="nav-link" data-scroll-target="#research-goal-and-hypothesis">Research Goal and Hypothesis</a></li>
  <li><a href="#data-science-questions" id="toc-data-science-questions" class="nav-link" data-scroll-target="#data-science-questions">Data Science Questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">An Analysis of the Trend in Today’s Music Industry</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Tianze Yang </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="project-introduction" class="level2">
<h2 class="anchored" data-anchor-id="project-introduction">Project Introduction</h2>
<p>Music, arguably invented earlier than language, has been an important part of human civilization. During the years music has been constantly evolving and could be serve as a reflection on the society of its time. The pace of the evolve though, is noticeable accelerated in recent years. With the new technology and the rise of Gen Z as main consumer, nearly every aspect of the industry has changed significantly. New genres such as sped-ups are emerging in a speedy way and streaming service has completely changed the way consumer access to music and hence their consuming behaviors. More powerful AI tools help independent artist to produce quality works, while crossover between music and video and games become a new force due to platform like TikTok. To understand the trend in contemporary music offers not only a great commercial value but also provide us an insight into modern society and this new generation. In this project, we will employ a data driven method to depict the revolution in music industry and try to predict its future.</p>
</section>
<section id="background-research-works-done-in-this-field" class="level2">
<h2 class="anchored" data-anchor-id="background-research-works-done-in-this-field">Background: Research Works Done in this Field</h2>
<p>Since the great changes in musical industry, extensive researches were done in this realm, offering us the background knowledge and valuable insights. I shall address two important publications here which provide us important background knowledge and insight on understanding today’s music trend.</p>
<section id="publication-1-changing-their-tune-how-consumers-adoption-of-online-streaming-affects-music-consumption-and-discovery" class="level4">
<h4 class="anchored" data-anchor-id="publication-1-changing-their-tune-how-consumers-adoption-of-online-streaming-affects-music-consumption-and-discovery"><code>Publication-1</code>: Changing Their Tune: How Consumers’ Adoption of Online Streaming Affects Music Consumption and Discovery</h4>
<p>This paper throughly described how the streaming service impact the way music were consumed and user behavior. The author segment the research into three parts, first they identify the increment contribution of streaming service is contributing to the overall music consumption. Secondly, it compare the diversity in the consumers’ choice in music categories between streaming service and traditional ownership model. Finally, it researched what could impact a song’s success in the streaming environment <span class="citation" data-cites="datta2018changing">(<a href="#ref-datta2018changing" role="doc-biblioref">Datta, Knox, and Bronnenberg 2018</a>)</span>.</p>
<p>To analysis the effects of adopting streaming service on individual music consumption, they use an anonymous third party service tracking the consumer’s platform preference and their listening behavior to create a panel of data. By applying a difference in differences (DiD) method, the authors compare the consumption differences between the group of people who adopt the streaming service and people who did not. According to their findings, adopting to streaming lead to a 49% increase of music consumption across all the platform. Furthermore listeners in streaming service tend to have a wider spectrum of music choices. The author noted it is benefit to those smaller artist to get attention but it also make the situation more competitive since the listeners now tend to discover new music instead of staying still <span class="citation" data-cites="datta2018changing">(<a href="#ref-datta2018changing" role="doc-biblioref">Datta, Knox, and Bronnenberg 2018</a>)</span>.</p>
</section>
<section id="publication-2-tastes-and-age-a-study-of-the-relationship-between-music-tastes-and-age-cohorts" class="level4">
<h4 class="anchored" data-anchor-id="publication-2-tastes-and-age-a-study-of-the-relationship-between-music-tastes-and-age-cohorts"><code>Publication-2</code>: Tastes and Age: A Study of the Relationship between Music Tastes and Age Cohorts</h4>
<p>In this paper, the author tried to investigate the impact of ages’ influence on individual music preference. The main object is to discover the relationship between then contemporary music taste and age age cohorts <span class="citation" data-cites="glevarec2020tastes">(<a href="#ref-glevarec2020tastes" role="doc-biblioref">Glevarec, Nowak, and Mahut 2020</a>)</span>. The data they used for research is the ELIPSS inquiry from 2013 conducted by the Centre of Socio-Political Data in Pairs. This enquires include 13 genres of music and with a sample space of 892. The research methodology employed a regression analysis on the socio-demographic variables including age, education, profession, gender of a person and their taste of music genres. The finding reveal that for most music genres, age of the listener is the dominate factor to determine whether it will be appreciate or not. It is also noticed that people tend to rate the artist higher when they are at a similar age with the listener. Also, the author went further and point out it can be inferred from the research that people are likely to be linked to an artist they encountered during their teenager <span class="citation" data-cites="glevarec2020tastes">(<a href="#ref-glevarec2020tastes" role="doc-biblioref">Glevarec, Nowak, and Mahut 2020</a>)</span>.</p>
</section>
<section id="other-relevent-works" class="level4">
<h4 class="anchored" data-anchor-id="other-relevent-works">Other Relevent Works:</h4>
<p>There are many other researches dive into the topic of the contemporary music trends in many perspective to provide us the background of this project. The trend can be split into three aspect, the trend for music content, the trend in music consumption and the trend in music creation.</p>
<section id="trend-in-music-contents" class="level5">
<h5 class="anchored" data-anchor-id="trend-in-music-contents">Trend in Music Contents:</h5>
<p>In terms of music content, current researches indicating the lyric of the songs are getting simpler and the songs with simple lyrics tend to be more successful <span class="citation" data-cites="varnum2021song">(<a href="#ref-varnum2021song" role="doc-biblioref">Varnum et al. 2021</a>)</span>. Also, according to research, the lyrics now more likely to contain negative emotions <span class="citation" data-cites="brand2019cultural">(<a href="#ref-brand2019cultural" role="doc-biblioref">Brand, Acerbi, and Mesoudi 2019</a>)</span>. This is important to notice since the research done by Borg and Hokkanen shows that lyrics plays an significant role in a music’s success <span class="citation" data-cites="borg2011makes">(<a href="#ref-borg2011makes" role="doc-biblioref">Borg and Hokkanen 2011</a>)</span>. There are also new genres emerging, Base on the second publication summary above, we can observe the new Z generation is the key audience of those novice genres <span class="citation" data-cites="datta2018changing">(<a href="#ref-datta2018changing" role="doc-biblioref">Datta, Knox, and Bronnenberg 2018</a>)</span>. According to Klement &amp; Strambach, the local and extra-local knowledge source contribute to those new genres creation <span class="citation" data-cites="klement2019new">(<a href="#ref-klement2019new" role="doc-biblioref">Klement and Strambach 2019</a>)</span>.</p>
</section>
<section id="trend-in-music-consumption" class="level5">
<h5 class="anchored" data-anchor-id="trend-in-music-consumption">Trend in Music Consumption:</h5>
<p>The advent of streaming services has totally revolutionized music consumption as describe in the first publication’s summary. Additionally, changes also reflect on the form music been consumed. Nowadays music is often consume in combine with video or games. An good example is the TikTok. According to study, the more interactive mode in platform like TikTok short video make people foster affliction by mixing the music with image, video and text, and it is also shown as a way to self-express and connect people with similar afflictions <span class="citation" data-cites="vizcaino2022music">(<a href="#ref-vizcaino2022music" role="doc-biblioref">Vizcaı́no-Verdú and Abidin 2022</a>)</span>.</p>
</section>
<section id="trend-in-music-creation" class="level5">
<h5 class="anchored" data-anchor-id="trend-in-music-creation">Trend in Music Creation:</h5>
<p>There are also revolution in music creations. With more AI assistance tools emerging, even individual without traditional musical training could create songs, however it also means the standard for hit song is increasing <span class="citation" data-cites="liu2019everybody">(<a href="#ref-liu2019everybody" role="doc-biblioref">Liu 2019</a>)</span>. Also the streaming service like Spotify enable artist to upload their work without the need of signing to a label. However, these technology doesn’t always promote the creation. THOMAS HODGSON described it as ‘Creative Ambivalence’ mainly caused by the opaque nature of recommending algorithm <span class="citation" data-cites="hodgson2021spotify">(<a href="#ref-hodgson2021spotify" role="doc-biblioref">Hodgson 2021</a>)</span>. Artist might spend more time to align their work to the algorithm rather than being creative <span class="citation" data-cites="hodgson2021spotify">(<a href="#ref-hodgson2021spotify" role="doc-biblioref">Hodgson 2021</a>)</span>.</p>
</section>
</section>
</section>
<section id="research-goal-and-hypothesis" class="level2">
<h2 class="anchored" data-anchor-id="research-goal-and-hypothesis">Research Goal and Hypothesis</h2>
<p>In this project, our aim is to provide a comprehensive, data-driven analysis of contemporary music industry trends and potentially predict its future shifts. We hypothesize that the rise of streaming platforms, have significantly influenced on both music creation and consumption. And the as the Generation Z becoming the main consumer, there would be significant changes regarding the genre, rhythm and lyric of trending music. We also expect to see a trend where individual artist and artists who also from Gen Z are thriving.</p>
</section>
<section id="data-science-questions" class="level2">
<h2 class="anchored" data-anchor-id="data-science-questions">Data Science Questions</h2>
<p>To test our hypothesis, we shall try to answer these data driven questions:</p>
<section id="music-contents" class="level5">
<h5 class="anchored" data-anchor-id="music-contents">Music Contents:</h5>
<ol type="1">
<li>What are the most popular genres of music today?</li>
<li>How did the popular genres changed over the three decades and is the changing rate faster or not?</li>
<li>Are the songs now more homogenized than before in terms of the rhythm, lyrics and genre?</li>
<li>Has the linguistic diversity in trending music becoming greater or not?</li>
<li>What are genre or artist attract most to Generation Z?</li>
</ol>
</section>
<section id="music-consumption" class="level5">
<h5 class="anchored" data-anchor-id="music-consumption">Music Consumption:</h5>
<ol type="1">
<li>Did the consuming behavior shifted for music listeners compare with before streaming service?</li>
<li>What is the impact of the integration between music and other media type like game and videos?</li>
<li>To what extent has the music industry been impacted by the Covid?</li>
<li>Are there any common traits for those songs been made into a Sped-up remixes?</li>
<li>About the listeners of different genres or rhythms, are they highly clustered in some trait?</li>
</ol>
</section>
<section id="music-creation" class="level5">
<h5 class="anchored" data-anchor-id="music-creation">Music Creation:</h5>
<ol type="1">
<li>Is it easier now to gain fame as an independent artist since AI tools make it easier to produce high quality music?</li>
<li>Has there been a noticeable trend in artists archive fame younger than before?</li>
</ol>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-borg2011makes" class="csl-entry" role="listitem">
Borg, Nicholas, and GEORGE Hokkanen. 2011. <span>“What Makes for a Hit Pop Song? What Makes for a Pop Song.”</span> <em>Unpublished Thesis, Stanford University, California, USA</em>.
</div>
<div id="ref-brand2019cultural" class="csl-entry" role="listitem">
Brand, Charlotte O, Alberto Acerbi, and Alex Mesoudi. 2019. <span>“Cultural Evolution of Emotional Expression in 50 Years of Song Lyrics.”</span> <em>Evolutionary Human Sciences</em> 1: e11.
</div>
<div id="ref-datta2018changing" class="csl-entry" role="listitem">
Datta, Hannes, George Knox, and Bart J Bronnenberg. 2018. <span>“Changing Their Tune: How Consumers’ Adoption of Online Streaming Affects Music Consumption and Discovery.”</span> <em>Marketing Science</em> 37 (1): 5–21.
</div>
<div id="ref-glevarec2020tastes" class="csl-entry" role="listitem">
Glevarec, Hervé, Raphaël Nowak, and Dominique Mahut. 2020. <span>“Tastes of Our Time: Analysing Age Cohort Effects in the Contemporary Distribution of Music Tastes.”</span> <em>Cultural Trends</em> 29 (3): 182–98.
</div>
<div id="ref-hodgson2021spotify" class="csl-entry" role="listitem">
Hodgson, Thomas. 2021. <span>“Spotify and the Democratisation of Music.”</span> <em>Popular Music</em> 40 (1): 1–17.
</div>
<div id="ref-klement2019new" class="csl-entry" role="listitem">
Klement, Benjamin, and Simone Strambach. 2019. <span>“How Do New Music Genres Emerge? Diversification Processes in Symbolic Knowledge Bases.”</span> <em>Regional Studies</em> 53 (10): 1447–58.
</div>
<div id="ref-liu2019everybody" class="csl-entry" role="listitem">
Liu, Sissi. 2019. <span>“Everybody’s Song Making: Do-It-Yourself with and Against Artificial Intelligence.”</span> <em>Performance Research</em> 24 (1): 120–28.
</div>
<div id="ref-varnum2021song" class="csl-entry" role="listitem">
Varnum, Michael EW, Jaimie Arona Krems, Colin Morris, Alexandra Wormley, and Igor Grossmann. 2021. <span>“Why Are Song Lyrics Becoming Simpler? A Time Series Analysis of Lyrical Complexity in Six Decades of American Popular Music.”</span> <em>PloS One</em> 16 (1): e0244576.
</div>
<div id="ref-vizcaino2022music" class="csl-entry" role="listitem">
Vizcaı́no-Verdú, Arantxa, and Crystal Abidin. 2022. <span>“Music Challenge Memes on TikTok: Understanding in-Group Storytelling Videos.”</span> <em>International Journal of Communication</em> 16: 26.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>